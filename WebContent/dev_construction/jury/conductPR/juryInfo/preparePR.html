<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>准备评审</title>
<!-- 字体图标 -->
<link rel="stylesheet" type="text/css" href="bootstrap/font-awesome-4.7.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="../../../bootstrap/css/bootstrap.css"/>
 <link rel="stylesheet" type="text/css" href="../../../bootstrap/css/select2.css"/> 
<link rel="stylesheet" type="text/css" href="../../../css/form.css"/>
<script type="text/javascript" src="../../../js/jquery/jquery-1.9.1/jquery.min.js"></script>

<script type="text/javascript" src="../../../bootstrap/js/bootstrap.min.js"></script>
<!-- <script src="../../../bootstrap/js/select2.min.js"></script> -->

<link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap-table.min.css">
	<link rel="stylesheet" type="text/css" href="css/form.css"/>
	<script type="text/javascript" src="upload/uploadify/jquery.uploadify.min.js"></script>
	<script type="text/javascript" src="upload/uploadFtpFileInfo.js"></script>
<script type="text/javascript" src="dev_construction/jury/conductPR/juryInfo/preparePR.js"></script>
<script type="text/javascript" src="dev_construction/jury/conductPR/juryPop/taskPop.js"></script>
<script type="text/javascript" src="dev_construction/jury/conductPR/juryPop/themePop.js"></script>
<script type="text/javascript" src="dev_construction/jury/conductPR/juryPop/checkPop.js"></script>
<script type="text/javascript" src="dev_construction/jury/conductPR/juryPop/juryUserPop.js"></script>
<script type="text/javascript" src="dev_construction/jury/conductPR/juryInfo/juryDefect.js"></script>
<!-- <script type="text/javascript" src="dev_construction/requirement/requirement_analyze/task_accept/view_taskdetail.js"></script>
 --><script type="text/javascript" src="dev_construction/requirement/reqTask_phased/task_phased_jury.js"></script>
<script src="pages/suser/suserPop.js"></script>
<script src="bootstrap/js/bootstrap-table.min.js"></script>
<script src="bootstrap/js/bootstrap-table-zh-CN.js"></script>	
<script type="text/javascript" src="dev_construction/jury/conductPR/juryInfo/prepareList.js"></script>
	</head>
<body>

<div class="main_iframe_con main_iframeFormW">
	<div class="widget-box">
		<div class="widget-content nopadding">
		<div id="ms_context">
			<ul class="nav nav-tabs bootstrapTabs" id="myJuryTab">
				<li class="active" id="tab_jury_info"><a href="#prepare_div" data-toggle="tab" >评审基本信息</a></li>
				<li id="tab_jury_defect" style="display: none;"><a href="#defect_div" data-toggle="tab" >缺陷及解决情况</a></li>
				<li id="tab_finish_jury" style="display: none;"><a href="#finish_jury_div" data-toggle="tab" >完成评审情况</a></li>
				<li id="tab_jury_conclusion" style="display: none;"><a href="#conclusion_div" data-toggle="tab" >评审结论</a></li>
			</ul>

		</div>
		<div class="tab-content">
			<div class="tab-pane active" id="prepare_div">
				
				<form id="juryPrepare">
				<div class="ecitic-title-table">
					<table class="table table-striped table-hover table-bordered table-center table-th tablr-input-text">
						<tbody>
						<tr>
							<td class="table-text">评审名称：</td>
							<td>
								<div><input type="text" id="jury_name" name="G.jury_name" placeholder="评审名称" validate="v.required" valititle="该项为必填项"/></div>
							</td>
							<td class="table-text">所属应用：</td>
							<td>
								<div><input type="hidden" id="system_id" name="G.system_id"/></div>
								<div><input type="text" id="system_name" name="G.system_name" readOnly="true"/></div>
							</td>
						</tr>
						<tr>
							<td class="table-text">评审主题：</td>
							<td ><div>
							<input type="hidden" id="theme_id" name="G.theme_id" value="" validate="v.required" valititle="该项为必填项" >
							<input type="text" id="theme_name" name="G.theme_name" readOnly="true" validate="v.required" valititle="该项为必填项" placeholder="请点击选择"/></div></td>
							<td class="table-text">评审过程：</td>
							<td><input type="hidden" id="req_task_state" name="G.req_task_state"/>
							<input type="text" id="process_name" name="G.process_name" readOnly="true" /></td>
							
						</tr>
						<tr>
							<td class="table-text">评审发起人：</td>
							<td><input type="hidden" id="sponsor_id" name="G.sponsor_id" validate="v.required" valititle="该项为必填项" />
							<input type="text" placeholder="评审发起人" id="sponsor_name" name="G.sponsor_name" readOnly="true" validate="v.required" valititle="该项为必填项" placeholder="请点击选择"/></td>
							<td class="table-text">评审负责人：</td>
							<td><input type="hidden" id="jury_principal_id" name="G.jury_principal_id"/>
							<input type="text" placeholder="评审负责人" id="jury_principal_name" name="G.jury_principal_name" readOnly="true" validate="v.required" valititle="该项为必填项" placeholder="请点击选择"/></td>
							
						</tr>
						<tr>
							<td class="table-text" style="display: none">评审定级：</td>
							<td style="display: none"><select id="jury_grade" name="G.jury_grade" validate="v.required" valititle="该项为必填项" style="width:100%;"></select></td>
							 
							 <td class="table-text">当前评审级别：</td>
							<td><select id="at_jury_grade" disabled="disabled" name="G.at_jury_grade" validate="v.required" valititle="该项为必填项" style="width:100%;"></select></td>
							<td colspan="2"></td>
						</tr>
						
						<tr>
							<td class="table-text">评审内容概述：</td>
							<td colspan="3"><textarea id="jury_desc" name="G.jury_desc"></textarea></td>
						</tr>
						<tr style="display:none" id="tr_compere">
							<td class="table-text">评审主持人：</td>
							<td colspan="3"><input type="hidden" id="compere_id" name="G.compere_id" />
							<input type="text" id="compere_name" name="G.compere_name" placeholder="请点击选择"/><strong class="high">*</strong></td>
							
						</tr>
						<tr style="display: none" id="tr_feedback">
							<td class="table-text">评审反馈时间：</td>
							<td>
								<div><input type="text" readonly id="feedback_time" name="G.feedback_time" onClick="WdatePicker({dateFmt:'yyyy-MM-dd', autoPickDate:true, minDate: '%y-%M-%d'});" /><strong class="high">*</strong></div>
							</td>
							<td class="table-text">评审方式：</td>
							<td><div id="jury_type2"></div><strong class="high">*</strong></td>
						</tr>
						
					
						</tbody>
					</table>
					
				</div>
				</form>
				<!-- 关联评审任务 -->
				<div class="ecitic-title">
						<span>关联评审任务<em></em></span>
						<i></i>
				</div>
				<div class="ecitic-title-table">
					<!-- <div class="ecitic-operation" id="check_taskList">
						<button class="btn btn-ecitic" id="req_task_choice">选择评审任务</button>
						<button class="btn btn-ecitic"  style="margin-left:1px;"
					   		id="deleteSchemel" onclick="del('check_task');">删除</button>
					   		
					</div> -->
					<table class="table table-bordered table-hover table-center table-th tablr-input-text" id="juryTasktable">
						<tbody><tr>
							<th width="5%"></th>
							<th>任务名称</th>
							<th>任务编码</th>
							<th>需求点编码</th>
							<th>任务从属</th>
							<th>所属应用</th>
							<th>操作</th>
						</tr>
						
					</tbody></table>
					
				</div>
				<div class="" id="juryLiAll"  style="display: none;">
					<ul class="tabD">
					<!-- 
						<li class="tabBtn">评审交付物</li>
						 -->
						<li class="tabBtn" id="juryUserLi" style="display: none;">评审人员</li>
						<li class="tabBtn" id="juryCheckLi" style="display: none;">评审检查项</li>
						<div class="clear"></div>
					</ul>
					<!--内容区域-->
					<ul class="content">
						<!--tab1-->
						<!-- 
						<li class="tabContListD" style="display: none;">
							内嵌tab1
						</li>
						 -->
						<!--tab2-->
						<li class="tabContListD" style="display: none;" id="juryUserLiD">
							<div class="ecitic-operation" id="check_userList">
								<button class="btn btn-ecitic" id="pop_jury_user">选择评审人员</button>
								<button class="btn btn-ecitic" style="margin-left:1px;"
					   		id="deleteSchemel" onclick="delCheck('jury_user');">删除</button>
							</div>
							<div class="ecitic-title-table">
								<table class="table table-bordered table-hover table-center table-th tablr-input-text" id="juryUsertable">
								<tbody><tr id="juryPerson">
									<th width="5%"></th>
									<th>评审人员名称</th>
									<!-- <th>评委级别</th> -->
									<th width="15%">评审角色</th>
									<th>评委岗位</th>
									<th>评委是否行员</th>
									
								</tr>
								</tbody>
							</table>
							</div>
						</li>
						<!-- tab3 -->
						<li class="tabContListD on" style="display: none;" id="juryCheckLiD">
							<div class="ecitic-operation" id="check_checkList">
								<button class="btn btn-ecitic" id="addTackCheck" >添加评审检查项</button>
								<button class="btn btn-ecitic"  style="margin-left:1px;"
					   		id="deleteSchemel" onclick="delCheck('jury_check');" >删除</button>
							</div>
							<div class="ecitic-title-table">
								<table class="table table-bordered table-hover table-center table-th tablr-input-text" id="juryChecktable">
								<tbody><tr>
									<th width="5%"></th>
									<th>评审检查项</th>
									<th>评审负责人角色</th>
								</tr>
								</tbody>
							</table>
							</div>
							
						</li>
					</ul>
				</div>
				<input type="hidden" id="jury_sava_type" name="G.jury_sava_type">
				<input type="hidden" id="jury_id" name="G.jury_id">
				<div class="ecitic-save" id="jury_save_D">
					<input class="btn btn-ecitic" data-dismiss="modal" value="保存并提交" id="jurySave" type="button" /> 
					<!-- <input class="btn btn-ecitic" data-dismiss="modal" value="保存并发起" id="jurySaveSponsor" type="button"/> -->
					<input class="btn btn-ecitic" data-dismiss="modal" value="返回" name="closePageTabConfirm" type="button" />
				</div>
			</div>
		
			<div class="tab-pane fade" id="defect_div">
				<div class="main_iframe_con">
			        <div class="ecitic-operation" >
			        	<div id="defect_query_info">
							<button class="btn btn-ecitic" id="defect_add">新增</button>
							<button class="btn btn-ecitic" id="defect_edit">修改</button>
							<button class="btn btn-ecitic" id="defect_del">删除</button>
							<div id="finish_jury">
								<button class="btn btn-ecitic" id="finish_jury">完成评审</button>
							</div>
						</div>
						
						<div id="defect_follow">
							<button class="btn btn-ecitic" id="defect_dispose">处理</button>
							<button class="btn btn-ecitic" id="defect_verify">验证</button>
						</div>
						<button class="btn btn-ecitic" id="defect_view">查看</button>
					</div>
					<div class="ecitic-new">
					<table class="table table-bordered table-hover" id="juryDefectInfo">
						
					</table>
				</div>
			</div>
		</div>
		<div id="finish_jury_div" class="tab-pane fade">
			<div class="ecitic-title-table">
				<table class="table table-bordered table-hover table-center table-th tablr-input-text" id="juryUsertable2">
					<tbody><tr id="juryPerson2">
						<th width="5%"></th>
						<th>评审人员名称</th>
						<!-- <th>评委级别</th> -->
						<th width="15%">评审角色</th>
						<th>评委岗位</th>
						<th>评委是否行员</th>
						
					</tr>
					</tbody>
				</table>
			</div>
		</div>
		
		<div id="conclusion_div" class="tab-pane fade">
	    	<div class="ecitic-title-title"><span id="end_jury_title">评审记录表</span></div>
		    	<div class="main_iframe_con">
					<div class="ecitic-title-table">
					<table class="table table-striped table-hover table-bordered table-center table-th tablr-input-text">
						<tbody>
						<tr>
							<td class="table-text" width="13%">需求点编码：</td>
							<td width="20%">
								<div id="sub_req_code"></div>
							</td>
							<td class="table-text" width="13%">需求点名称：</td>
							<td colspan="3">
								<div id="sub_req_name"></div>
							</td>
							
						</tr>
						<tr>
							
							<td class="table-text" width="13%">评审主题：</td>
							<td width="20%">
								<div id="con_theme_name"></div>
							</td>
							<td class="table-text" width="13%">评审主持人：</td>
							<td width="20%">
								<div id="con_compere_name"></div>
							</td>
							<td class="table-text" width="13%">评审负责人：</td>
							<td width="20%">
								<div id="con_jury_principal_name"></div>
							</td>
						</tr>
						<tr>
							<td class="table-text">所属主办应用：</td>
							<td>
								<div id="con_system_name"></div>
							</td>
							<td class="table-text">评审方式：</td>
							<td>
								<div id="con_jury_type_name"></div>
							</td>
							<td class="table-text">当前评审级别：</td>
							<td>
								<div id="con_at_grade_name"></div>
							</td>
						</tr>
						
						
						<tr>
							<td class="table-text">评审过程：</td>
							<td>
								<div id="con_process_name"></div>
							</td>
							<td class="table-text"><div>缺陷总数：</div></td>
							<td>
								<div id="con_defect_count"></div>
							</td>
							<td class="table-text"><div>未解决缺陷数：</div></td>
							<td>
								<div id="con_unsolved_defect_count"></div>
							</td>
						</tr>
						<tr>
						<tr>
						<td class="table-text">评委及列席人员：</td>
							<td colspan="5">
								<div id="jury_user_name_all"></div>
								<input id="jury_user_no_all" type="hidden"></input>
								<input id="task_user_no_all" type="hidden"></input>
							</td>
						</tr>
						<tr>
						<td class="table-text">评审内容：</td>
							<td colspan="5">
								<div id="con_jury_desc"></div>
							</td>
						</tr>
							</tbody></table>
						</div>
						
						<!-- <div class="ecitic-title">
							<span>评审结论<em></em></span>
							<i></i>
						</div>
						<div class="ecitic-title-table">
							<table class="table table-striped table-hover table-bordered table-center table-th tablr-input-text" id="con_juryTasktable">
								<tbody><tr>
									<th>序号</th>
									<th style='text-align: center; '>任务名称</th>
									<th style='text-align: center; '>应用名称</th>
									<th style='text-align: center; '>任务类型</th>
									<th style='text-align: center; width: 200px'>评审结论</th>
									<th style='text-align: center; '>备注</th>
								</tr>
								</tbody>
							</table>
						</div> -->
						
						<div class="ecitic-title">
							<span>相关评审附件<em></em></span>
							<input id="file_id" name="FILE_ID" type="hidden" />
							<i></i>
						</div>
						<div>
							<div class="ecitic-operation">
								<button class="btn btn-ecitic" id="add_file" >添加</button>
								<button class="btn btn-ecitic" id="delete_file" >删除</button>
								<a href="sfile/downloadFTPFile.asp?id=m_002" class="file_template_style">评审记录表模版</a>
								<a href="sfile/downloadFTPFile.asp?id=m_003" class="file_template_style">评审遗留问题模版</a>
							</div>
							<div class="ecitic-title-table ecitic-new">
								<table id="table_file" class="table table-bordered table-hover">
								</table>
							</div>
						</div>
						
						<div class="ecitic-title">
							<span>评审结论<em></em></span>
							<i></i>
						</div>
						<div class="ecitic-title-table">
							<table class="table table-striped table-hover table-bordered table-center table-th tablr-input-text">
								<tbody><tr>
							
									<td class="table-text" width="13%">评审结论：</td>
									<td>
										<div id="jury_result"></div>
									</td>
									</tr><tr>
									<td class="table-text" width="13%">备注：</td>
									<td>
										<textarea id="up_jury_desc" name="G.up_jury_desc"></textarea>
									</td>
									
								</tr></tbody>
							</table>
						</div>
						<!--
						<div id="setJuryEndModel" class="modal hide fade pb20" tabindex="-1">
							<div class="ecitic-title-table" id="">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
									<h3 id="processModalLabel">添加过程</h3>
									
								</div>
								 <form id="processForm">
									<div class="modal-body">
										<div id="ms_context">
											<table width="100%" cellspacing="0" cellpadding="0" class="table table-striped table-hover table-bordered tablr-input-text">
												<tr>
													<td colspan="4">
													<label class="labelRadio" style="width: 100px">
														<input type="radio" name="G.jury_result" value="01" checked>完成评审
													</label>
													</td>
												</tr>
												<tr>
													<td class="ecitic-right">评审说明：</td>
													<td colspan="3">
														<textarea id="up_jury_desc" class="citic-sele-ast" name="G.up_jury_desc" validate="v.required" valititle="该项为必填项"></textarea>
													</td>
												</tr>
											</table>
										</div>
									</div>
								</form> 
							
								<div class="ecitic-save">
									<input class="btn btn-ecitic" data-dismiss="modal" value="提交" id="juryEndSubmit" type="button" />
									<input class="btn btn-ecitic" data-dismiss="modal" value="返回" id="blackJuryEnd" type="button" />
								</div>
							</div>
						</div>
						-->
						<input type="hidden" id="all_jury_task" name="G.all_jury_task">
						<div class="ecitic-save">
							<!-- <input class="btn btn-ecitic" data-dismiss="modal" value="完成评审" id="juryEnd" type="button" /> -->
							<input class="btn btn-ecitic" data-dismiss="modal" value="完成评审" id="juryEndSubmit" type="button" />
							<input class="btn btn-ecitic" data-dismiss="modal" value="关闭" name="closePageTabConfirm" type="button" />
						</div>
		           
	    			</div>
				</div>
		
			</div>
		</div>
	</div>
</div>
<div id="addDivTask"></div>
<!-- 选择评审检查项（多选） -->
<div id="file_modal"></div>
<div id="fileview_modal"></div>

</body>
<script type="text/javascript">

initVlidate($("#juryPrepare"));
//全选功能  
//name是你点击出发chexbox的name itemname 是你要操作cheeckbox的name  
function qcheckbox(name,itemname){  
  //if($("input[name='"+name+"']:checkbox").is("checked")) { 
	if($("#allCkb").is(":checked")){
   		$("input[name='"+itemname+"']:checkbox").attr("checked",true);
   }else{  
   		$("input[name='"+itemname+"']:checkbox").attr("checked",false);   
   }
}  
//chname你选择的checbox的name  任务  
function del(chname){  
     var chobj= $("input[name='"+chname+"']:checkbox"); 
     var delid="";//删除的ID  
     chobj.each(function(){  
         if($(this).is(":checked")){
        	 var chobjTask= $("input[name='"+chname+"']:checkbox"); 
        	 if(chobjTask.length==1){
        		 alert("不能删除全部任务");
        		 return;
        	 }else{
                 $(this).parent().parent().parent().remove();  
        	 }
         }  
      });    
}  

function delCheck(chname){  //人员，评审项
    var chobj= $("input[name='"+chname+"']:checkbox"); 
    var delid="";//删除的ID  
    chobj.each(function(){  
        if($(this).is(":checked")){
            $(this).parent().parent().parent().remove();  
        }  
     });    
} 

function info(delid){
	var task_ids=$("#task_ids").val();
	var delobj= delid.split(","); 
	var task_id= task_ids.split(","); 
	var str="";
	for(var j=0;j<task_id.length;j++){  

		var a=true;  
	    for(var k=0;k<delobj.length;k++){  
	         if(delobj[k]==task_id[j]){  
	             a=false;  
	             break;  
	         }  
	      }
	      
	      if(a){
				if(str==""){
					str = task_id[j];
				}else{
					str = str+","+task_id[j];
				}
	      }
	}
	$("#task_ids").val(str);
}

</script>
</html>